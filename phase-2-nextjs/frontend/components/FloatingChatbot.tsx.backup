"use client";

import { useState, useEffect, useRef } from "react";
import { Bot, X, Send, Globe } from "lucide-react";
import { sendChatMessage } from "@/lib/chatApi";
import { getUser } from "@/lib/auth";

interface TaskFormData {
    title: string;
    description: string;
    priority: string;
    due_date: string;
    category: string;
}

export function FloatingChatbot() {
    const [isOpen, setIsOpen] = useState(false);
    const [messages, setMessages] = useState<{ text: string; isUser: boolean }[]>([]);
    const [inputMessage, setInputMessage] = useState("");
    const [isLoading, setIsLoading] = useState(false);
    const [conversationId, setConversationId] = useState<number | undefined>();
    const [language, setLanguage] = useState<"en" | "ur">("en");
    const [showTaskForm, setShowTaskForm] = useState(false);
    const [taskFormData, setTaskFormData] = useState<TaskFormData>({
        title: "",
        description: "",
        priority: "",
        due_date: "",
        category: ""
    });
    const messagesEndRef = useRef<HTMLDivElement>(null);

    // Initialize with welcome message
    useEffect(() => {
        if (messages.length === 0) {
            const welcomeMessage = language === "en"
                ? "ğŸ‘‹ **Welcome to Task Assistant!**\n\nI can help you manage your tasks. What would you like to do?\n\nâ€¢ Add a new task\nâ€¢ View my tasks\nâ€¢ Complete a task\nâ€¢ Update a task\nâ€¢ Delete a task\nâ€¢ Ask about my schedule\n\nJust type what you need or click a suggestion!"
                : "ğŸ‘‹ **Ù¹Ø§Ø³Ú© Ø§Ø³Ø³Ù¹Ù†Ù¹ Ù…ÛŒÚº Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!**\n\nÙ…ÛŒÚº Ø¢Ù¾ Ú©Û’ Ú©Ø§Ù…ÙˆÚº Ú©Ùˆ Ù…Ù†Ø¸Ù… Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ù…Ø¯Ø¯ Ú©Ø± Ø³Ú©ØªØ§ ÛÙˆÚºÛ” Ø¢Ù¾ Ú©ÛŒØ§ Ú©Ø±Ù†Ø§ Ú†Ø§ÛÛŒÚº Ú¯Û’ØŸ\n\nâ€¢ Ú©Ø§Ù… Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº\nâ€¢ Ú©Ø§Ù… Ø¯ÛŒÚ©Ú¾ÛŒÚº\nâ€¢ Ú©Ø§Ù… Ù…Ú©Ù…Ù„ Ú©Ø±ÛŒÚº\nâ€¢ Ú©Ø§Ù… Ø§Ù¾ ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº\nâ€¢ Ú©Ø§Ù… Ø­Ø°Ù Ú©Ø±ÛŒÚº\nâ€¢ Ù…ÛŒØ±Û’ Ø´ÛŒÚˆÙˆÙ„ Ú©Û’ Ø¨Ø§Ø±Û’ Ù…ÛŒÚº Ù¾ÙˆÚ†Ú¾ÛŒÚº\n\nØ¨Ø³ Ù„Ú©Ú¾ÛŒÚº Ú©Û Ø¢Ù¾ Ú©Ùˆ Ú©ÛŒØ§ Ú†Ø§ÛÛŒÛ’!";

            setMessages([{ text: welcomeMessage, isUser: false }]);
        }
    }, [language]);

    // Auto-scroll to bottom
    useEffect(() => {
        messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
    }, [messages, showTaskForm]);

    const handleSendMessage = async () => {
        if (!inputMessage.trim() || isLoading) return;

        const userMessage = inputMessage;

        // Check if user wants to add a task
        const addTaskKeywords = language === "en"
            ? ["add task", "new task", "create task"]
            : ["Ú©Ø§Ù… Ø´Ø§Ù…Ù„", "Ù†ÛŒØ§ Ú©Ø§Ù…"];

        const isAddTaskRequest = addTaskKeywords.some(keyword =>
            userMessage.toLowerCase().includes(keyword)
        );

        if (isAddTaskRequest) {
            setMessages([...messages, { text: userMessage, isUser: true }]);
            setInputMessage("");
            setShowTaskForm(true);
            return;
        }

        // Add user message immediately
        const newMessages = [...messages, { text: userMessage, isUser: true }];
        setMessages(newMessages);
        setInputMessage("");
        setIsLoading(true);

        try {
            // Get user ID from auth
            const user = getUser();
            const userId = user?.id || "guest";

            // Call phase-3 chatbot API
            const response = await sendChatMessage(userId, userMessage, conversationId, language);

            // Update conversation ID
            if (!conversationId) {
                setConversationId(response.conversation_id);
            }

            // Clean up response - remove special markers
            let cleanedResponse = response.response
                .replace(/<<SHOW_ADD_TASK_FORM>>/g, "")
                .replace(/<<[^>]+>>/g, "")
                .trim();

            // Add bot response
            setMessages([...newMessages, { text: cleanedResponse, isUser: false }]);
        } catch (error) {
            console.error("Chat error:", error);
            setMessages([
                ...newMessages,
                { text: "Sorry, I encountered an error. Please try again or check if the backend is running.", isUser: false }
            ]);
        } finally {
            setIsLoading(false);
        }
    };

    const handleTaskFormSubmit = async (e: React.FormEvent) => {
        e.preventDefault();

        if (!taskFormData.title.trim()) {
            alert(language === "en" ? "Please enter a task title" : "Ø¨Ø±Ø§Û Ú©Ø±Ù… Ú©Ø§Ù… Ú©Ø§ Ø¹Ù†ÙˆØ§Ù† Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº");
            return;
        }

        setIsLoading(true);
        setShowTaskForm(false);

        try {
            const user = getUser();
            const userId = user?.id || "guest";

            // Create task message for AI
            const taskMessage = `Add task: ${taskFormData.title}${taskFormData.description ? `, description: ${taskFormData.description}` : ""
                }${taskFormData.priority ? `, priority: ${taskFormData.priority}` : ""
                }${taskFormData.due_date ? `, due date: ${taskFormData.due_date}` : ""
                }${taskFormData.category ? `, category: ${taskFormData.category}` : ""
                }`;

            // Add user message
            const newMessages = [...messages, { text: `Creating task: ${taskFormData.title}`, isUser: true }];
            setMessages(newMessages);

            // Call AI to create task
            const response = await sendChatMessage(userId, taskMessage, conversationId, language);

            if (!conversationId) {
                setConversationId(response.conversation_id);
            }

            let cleanedResponse = response.response
                .replace(/<<SHOW_ADD_TASK_FORM>>/g, "")
                .replace(/<<[^>]+>>/g, "")
                .trim();

            setMessages([...newMessages, { text: cleanedResponse, isUser: false }]);

            // Reset form
            setTaskFormData({
                title: "",
                description: "",
                priority: "",
                due_date: "",
                category: ""
            });
        } catch (error) {
            console.error("Task creation error:", error);
            setMessages([
                ...messages,
                { text: "Failed to create task. Please try again.", isUser: false }
            ]);
        } finally {
            setIsLoading(false);
        }
    };

    const handleKeyPress = (e: React.KeyboardEvent) => {
        if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            handleSendMessage();
        }
    };

    const toggleLanguage = () => {
        const newLang = language === "en" ? "ur" : "en";
        setLanguage(newLang);

        const welcomeMessage = newLang === "en"
            ? "ğŸ‘‹ **Welcome to Task Assistant!**\n\nI can help you manage your tasks. What would you like to do?\n\nâ€¢ Add a new task\nâ€¢ View my tasks\nâ€¢ Complete a task\nâ€¢ Update a task\nâ€¢ Delete a task\nâ€¢ Ask about my schedule\n\nJust type what you need or click a suggestion!"
            : "ğŸ‘‹ **Ù¹Ø§Ø³Ú© Ø§Ø³Ø³Ù¹Ù†Ù¹ Ù…ÛŒÚº Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!**\n\nÙ…ÛŒÚº Ø¢Ù¾ Ú©Û’ Ú©Ø§Ù…ÙˆÚº Ú©Ùˆ Ù…Ù†Ø¸Ù… Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ù…Ø¯Ø¯ Ú©Ø± Ø³Ú©ØªØ§ ÛÙˆÚºÛ” Ø¢Ù¾ Ú©ÛŒØ§ Ú©Ø±Ù†Ø§ Ú†Ø§ÛÛŒÚº Ú¯Û’ØŸ\n\nâ€¢ Ú©Ø§Ù… Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº\nâ€¢ Ú©Ø§Ù… Ø¯ÛŒÚ©Ú¾ÛŒÚº\nâ€¢ Ú©Ø§Ù… Ù…Ú©Ù…Ù„ Ú©Ø±ÛŒÚº\nâ€¢ Ú©Ø§Ù… Ø§Ù¾ ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº\nâ€¢ Ú©Ø§Ù… Ø­Ø°Ù Ú©Ø±ÛŒÚº\nâ€¢ Ù…ÛŒØ±Û’ Ø´ÛŒÚˆÙˆÙ„ Ú©Û’ Ø¨Ø§Ø±Û’ Ù…ÛŒÚº Ù¾ÙˆÚ†Ú¾ÛŒÚº\n\nØ¨Ø³ Ù„Ú©Ú¾ÛŒÚº Ú©Û Ø¢Ù¾ Ú©Ùˆ Ú©ÛŒØ§ Ú†Ø§ÛÛŒÛ’!";

        setMessages([{ text: welcomeMessage, isUser: false }]);
        setConversationId(undefined);
        setShowTaskForm(false);
    };

    const handleBackToMenu = () => {
        const welcomeMessage = language === "en"
            ? "ğŸ‘‹ **Welcome to Task Assistant!**\n\nI can help you manage your tasks. What would you like to do?\n\nâ€¢ Add a new task\nâ€¢ View my tasks\nâ€¢ Complete a task\nâ€¢ Update a task\nâ€¢ Delete a task\nâ€¢ Ask about my schedule\n\nJust type what you need or click a suggestion!"
            : "ğŸ‘‹ **Ù¹Ø§Ø³Ú© Ø§Ø³Ø³Ù¹Ù†Ù¹ Ù…ÛŒÚº Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!**\n\nÙ…ÛŒÚº Ø¢Ù¾ Ú©Û’ Ú©Ø§Ù…ÙˆÚº Ú©Ùˆ Ù…Ù†Ø¸Ù… Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ù…Ø¯Ø¯ Ú©Ø± Ø³Ú©ØªØ§ ÛÙˆÚºÛ” Ø¢Ù¾ Ú©ÛŒØ§ Ú©Ø±Ù†Ø§ Ú†Ø§ÛÛŒÚº Ú¯Û’ØŸ\n\nâ€¢ Ú©Ø§Ù… Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº\nâ€¢ Ú©Ø§Ù… Ø¯ÛŒÚ©Ú¾ÛŒÚº\nâ€¢ Ú©Ø§Ù… Ù…Ú©Ù…Ù„ Ú©Ø±ÛŒÚº\nâ€¢ Ú©Ø§Ù… Ø§Ù¾ ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº\nâ€¢ Ú©Ø§Ù… Ø­Ø°Ù Ú©Ø±ÛŒÚº\nâ€¢ Ù…ÛŒØ±Û’ Ø´ÛŒÚˆÙˆÙ„ Ú©Û’ Ø¨Ø§Ø±Û’ Ù…ÛŒÚº Ù¾ÙˆÚ†Ú¾ÛŒÚº\n\nØ¨Ø³ Ù„Ú©Ú¾ÛŒÚº Ú©Û Ø¢Ù¾ Ú©Ùˆ Ú©ÛŒØ§ Ú†Ø§ÛÛŒÛ’!";

        setMessages([{ text: welcomeMessage, isUser: false }]);
        setShowTaskForm(false);
        setInputMessage("");
    };

    const handleQuickAction = (action: string) => {
        if (action.toLowerCase().includes("add") || action.includes("Ø´Ø§Ù…Ù„")) {
            setShowTaskForm(true);
            setMessages([...messages, { text: action, isUser: true }]);
        } else {
            setInputMessage(action);
        }
    };

    const handleMessageClick = (text: string) => {
        // Check if clicking on main menu link
        if (text.includes("Back to Main Menu") || text.includes("Ù…ÛŒÙ† Ù…ÛŒÙ†Ùˆ Ù¾Ø± ÙˆØ§Ù¾Ø³ Ø¬Ø§Ø¦ÛŒÚº")) {
            handleBackToMenu();
        }
    };

    return (
        <>
            {/* Floating Button */}
            <button
                onClick={() => setIsOpen(!isOpen)}
                className="fixed bottom-5 right-5 w-[60px] h-[60px] rounded-full bg-gradient-to-br from-teal-500 to-teal-700 text-white shadow-lg hover:shadow-2xl transition-all duration-300 hover:scale-110 z-50 flex items-center justify-center"
                aria-label="Toggle chatbot"
            >
                {isOpen ? (
                    <X className="w-6 h-6" />
                ) : (
                    <Bot className="w-7 h-7" />
                )}
            </button>

            {/* Chat Window */}
            {isOpen && (
                <div className="fixed bottom-24 right-5 w-[400px] h-[600px] bg-white rounded-2xl shadow-2xl z-50 flex flex-col overflow-hidden border border-gray-200">
                    {/* Header */}
                    <div className="bg-gradient-to-r from-teal-500 to-teal-700 text-white p-4 flex items-center justify-between">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                                <Bot className="w-6 h-6" />
                            </div>
                            <div>
                                <h3 className="font-semibold">Task Assistant</h3>
                                <p className="text-xs text-white/80">AI Powered</p>
                            </div>
                        </div>
                        <div className="flex items-center gap-2">
                            <button
                                onClick={toggleLanguage}
                                className="hover:bg-white/20 rounded-full p-1 transition-colors"
                                title={`Switch to ${language === "en" ? "Urdu" : "English"}`}
                            >
                                <Globe className="w-5 h-5" />
                            </button>
                            <button
                                onClick={() => setIsOpen(false)}
                                className="hover:bg-white/20 rounded-full p-1 transition-colors"
                            >
                                <X className="w-5 h-5" />
                            </button>
                        </div>
                    </div>

                    {/* Language Indicator */}
                    <div className="bg-teal-50 px-4 py-2 text-xs text-teal-700 border-b border-teal-100">
                        Language: {language === "en" ? "English" : "Ø§Ø±Ø¯Ùˆ (Urdu)"}
                    </div>

                    {/* Messages */}
                    <div className="flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50">
                        {messages.map((message, index) => (
                            <div
                                key={index}
                                className={`flex ${message.isUser ? "justify-end" : "justify-start"}`}
                            >
                                <div
                                    className={`max-w-[85%] rounded-2xl px-4 py-2 ${message.isUser
                                        ? "bg-gradient-to-r from-teal-500 to-teal-700 text-white"
                                        : "bg-white text-gray-800 border border-gray-200 shadow-sm"
                                        }`}
                                >
                                    <p className="text-sm whitespace-pre-line leading-relaxed">{message.text}</p>
                                </div>
                            </div>
                        ))}

                        {/* Task Form */}
                        {showTaskForm && (
                            <div className="bg-white border-2 border-teal-500 rounded-xl p-4 shadow-lg">
                                <h4 className="font-semibold text-teal-700 mb-3 flex items-center gap-2">
                                    â• {language === "en" ? "Create New Task" : "Ù†ÛŒØ§ Ú©Ø§Ù… Ø¨Ù†Ø§Ø¦ÛŒÚº"}
                                </h4>
                                <form onSubmit={handleTaskFormSubmit} className="space-y-3">
                                    {/* Title */}
                                    <div>
                                        <label className="block text-xs font-medium text-gray-700 mb-1">
                                            {language === "en" ? "Title *" : "Ø¹Ù†ÙˆØ§Ù† *"}
                                        </label>
                                        <input
                                            type="text"
                                            value={taskFormData.title}
                                            onChange={(e) => setTaskFormData({ ...taskFormData, title: e.target.value })}
                                            className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                                            placeholder={language === "en" ? "Enter task title" : "Ú©Ø§Ù… Ú©Ø§ Ø¹Ù†ÙˆØ§Ù† Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº"}
                                            maxLength={200}
                                        />
                                    </div>

                                    {/* Description */}
                                    <div>
                                        <label className="block text-xs font-medium text-gray-700 mb-1">
                                            {language === "en" ? "Description" : "ØªÙØµÛŒÙ„"}
                                        </label>
                                        <textarea
                                            value={taskFormData.description}
                                            onChange={(e) => setTaskFormData({ ...taskFormData, description: e.target.value })}
                                            className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                                            placeholder={language === "en" ? "Enter description (optional)" : "ØªÙØµÛŒÙ„ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)"}
                                            rows={2}
                                            maxLength={500}
                                        />
                                    </div>

                                    {/* Priority and Due Date */}
                                    <div className="grid grid-cols-2 gap-2">
                                        <div>
                                            <label className="block text-xs font-medium text-gray-700 mb-1">
                                                {language === "en" ? "Priority" : "ØªØ±Ø¬ÛŒØ­"}
                                            </label>
                                            <select
                                                value={taskFormData.priority}
                                                onChange={(e) => setTaskFormData({ ...taskFormData, priority: e.target.value })}
                                                className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                                            >
                                                <option value="">{language === "en" ? "Select" : "Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº"}</option>
                                                <option value="Low">{language === "en" ? "Low" : "Ú©Ù…"}</option>
                                                <option value="Medium">{language === "en" ? "Medium" : "Ø¯Ø±Ù…ÛŒØ§Ù†ÛŒ"}</option>
                                                <option value="High">{language === "en" ? "High" : "Ø²ÛŒØ§Ø¯Û"}</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-xs font-medium text-gray-700 mb-1">
                                                {language === "en" ? "Due Date" : "Ø¢Ø®Ø±ÛŒ ØªØ§Ø±ÛŒØ®"}
                                            </label>
                                            <input
                                                type="date"
                                                value={taskFormData.due_date}
                                                onChange={(e) => setTaskFormData({ ...taskFormData, due_date: e.target.value })}
                                                className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                                            />
                                        </div>
                                    </div>

                                    {/* Category */}
                                    <div>
                                        <label className="block text-xs font-medium text-gray-700 mb-1">
                                            {language === "en" ? "Category" : "Ø²Ù…Ø±Û"}
                                        </label>
                                        <input
                                            type="text"
                                            value={taskFormData.category}
                                            onChange={(e) => setTaskFormData({ ...taskFormData, category: e.target.value })}
                                            className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                                            placeholder={language === "en" ? "e.g., Work, Personal" : "Ù…Ø«Ù„Ø§Ù‹ØŒ Ú©Ø§Ù…ØŒ Ø°Ø§ØªÛŒ"}
                                            maxLength={100}
                                        />
                                    </div>

                                    {/* Buttons */}
                                    <div className="flex gap-2 pt-2">
                                        <button
                                            type="submit"
                                            disabled={isLoading}
                                            className="flex-1 bg-gradient-to-r from-teal-500 to-teal-700 text-white py-2 rounded-lg font-medium hover:shadow-lg transition-all disabled:opacity-50 text-sm"
                                        >
                                            {isLoading ? "..." : (language === "en" ? "Create Task" : "Ú©Ø§Ù… Ø¨Ù†Ø§Ø¦ÛŒÚº")}
                                        </button>
                                        <button
                                            type="button"
                                            onClick={() => {
                                                setShowTaskForm(false);
                                                setTaskFormData({ title: "", description: "", priority: "", due_date: "", category: "" });
                                            }}
                                            className="px-4 bg-gray-200 text-gray-700 py-2 rounded-lg font-medium hover:bg-gray-300 transition-colors text-sm"
                                        >
                                            {language === "en" ? "Cancel" : "Ù…Ù†Ø³ÙˆØ®"}
                                        </button>
                                    </div>
                                </form>
                            </div>
                        )}

                        {isLoading && !showTaskForm && (
                            <div className="flex justify-start">
                                <div className="bg-white text-gray-800 border border-gray-200 rounded-2xl px-4 py-3 shadow-sm">
                                    <div className="flex gap-1">
                                        <div className="w-2 h-2 bg-teal-500 rounded-full animate-bounce"></div>
                                        <div className="w-2 h-2 bg-teal-500 rounded-full animate-bounce" style={{ animationDelay: "0.1s" }}></div>
                                        <div className="w-2 h-2 bg-teal-500 rounded-full animate-bounce" style={{ animationDelay: "0.2s" }}></div>
                                    </div>
                                </div>
                            </div>
                        )}
                        <div ref={messagesEndRef} />
                    </div>

                    {/* Quick Actions */}
                    {(messages.length === 1 || messages[messages.length - 1]?.text.includes("Back to Main Menu") || messages[messages.length - 1]?.text.includes("Ù…ÛŒÙ† Ù…ÛŒÙ†Ùˆ")) && !isLoading && !showTaskForm && (
                        <div className="px-4 py-2 bg-gray-50 border-t border-gray-200">
                            <div className="flex flex-wrap gap-2">
                                <button
                                    onClick={() => handleQuickAction(language === "en" ? "Add task" : "Ú©Ø§Ù… Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº")}
                                    className="text-xs px-3 py-1.5 bg-teal-100 text-teal-700 rounded-full hover:bg-teal-200 transition-colors"
                                >
                                    {language === "en" ? "â• Add Task" : "â• Ú©Ø§Ù… Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº"}
                                </button>
                                <button
                                    onClick={() => handleQuickAction(language === "en" ? "View tasks" : "Ú©Ø§Ù… Ø¯ÛŒÚ©Ú¾ÛŒÚº")}
                                    className="text-xs px-3 py-1.5 bg-blue-100 text-blue-700 rounded-full hover:bg-blue-200 transition-colors"
                                >
                                    {language === "en" ? "ğŸ“‹ View Tasks" : "ğŸ“‹ Ú©Ø§Ù… Ø¯ÛŒÚ©Ú¾ÛŒÚº"}
                                </button>
                                <button
                                    onClick={() => handleQuickAction(language === "en" ? "Help" : "Ù…Ø¯Ø¯")}
                                    className="text-xs px-3 py-1.5 bg-purple-100 text-purple-700 rounded-full hover:bg-purple-200 transition-colors"
                                >
                                    {language === "en" ? "â“ Help" : "â“ Ù…Ø¯Ø¯"}
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Input */}
                    {!showTaskForm && (
                        <div className="p-4 bg-white border-t border-gray-200">
                            <div className="flex gap-2">
                                <input
                                    type="text"
                                    value={inputMessage}
                                    onChange={(e) => setInputMessage(e.target.value)}
                                    onKeyPress={handleKeyPress}
                                    placeholder={language === "en" ? "Type your message..." : "Ø§Ù¾Ù†Ø§ Ù¾ÛŒØºØ§Ù… Ù„Ú©Ú¾ÛŒÚº..."}
                                    className="flex-1 px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm"
                                    disabled={isLoading}
                                />
                                <button
                                    onClick={handleSendMessage}
                                    disabled={!inputMessage.trim() || isLoading}
                                    className="w-10 h-10 bg-gradient-to-r from-teal-500 to-teal-700 text-white rounded-full flex items-center justify-center hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    <Send className="w-4 h-4" />
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            )}
        </>
    );
}
