# Helm Values for Development Environment
# Task 3.3: Helm Values Examples
# Reference: specs/003-local-k8s-deployment/tasks.md
#
# Usage:
#   helm install todo-chatbot ./phase-4-local-deployment/helm/todo-chatbot \
#     -f phase-4-local-deployment/helm/todo-chatbot/values-dev.yaml \
#     --set secrets.OPENAI_API_KEY="sk-proj-..." \
#     --set secrets.BETTER_AUTH_SECRET="..."

# Global settings
global:
  environment: dev

# Namespace configuration
namespace:
  create: true
  name: todo-chatbot-dev  # Separate namespace for dev

# ConfigMap - Non-sensitive configuration
config:
  DATABASE_URL: "sqlite:////app/data/todo.db"
  LOG_LEVEL: "INFO"  # Info logging for development
  CORS_ORIGINS: "https://dev.todo-chatbot.example.com,http://localhost:3000"
  BETTER_AUTH_URL: "https://dev-api.todo-chatbot.example.com"
  BACKEND_PORT: "8001"
  FRONTEND_PORT: "80"
  VITE_API_URL: "https://dev-api.todo-chatbot.example.com"

# Secrets - MUST be overridden with actual values from secret management
secrets:
  OPENAI_API_KEY: "REPLACE_WITH_YOUR_OPENAI_API_KEY"
  BETTER_AUTH_SECRET: "REPLACE_WITH_YOUR_SECRET_MIN_32_CHARS"

# Backend configuration
backend:
  enabled: true
  replicaCount: 2  # High availability for dev testing

  image:
    repository: registry.example.com/todo-chatbot-backend
    tag: dev-latest  # Use dev tag
    pullPolicy: Always  # Always pull latest dev images

  service:
    type: ClusterIP
    port: 8001
    targetPort: 8001

  # Moderate resource limits for development
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  # Persistent storage for SQLite database
  persistence:
    enabled: true
    storageClass: "standard"
    accessMode: ReadWriteOnce
    size: 2Gi  # Larger for dev testing
    mountPath: /app/data

  livenessProbe:
    enabled: true
    path: /api/health
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    enabled: true
    path: /api/health
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

# Frontend configuration
frontend:
  enabled: true
  replicaCount: 2  # High availability for dev testing

  image:
    repository: registry.example.com/todo-chatbot-frontend
    tag: dev-latest  # Use dev tag
    pullPolicy: Always  # Always pull latest dev images

  service:
    type: ClusterIP  # Use Ingress for external access
    port: 80
    targetPort: 80

  # Moderate resource limits for development
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"

  livenessProbe:
    enabled: true
    path: /health
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 3
    failureThreshold: 3

  readinessProbe:
    enabled: true
    path: /health
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 2
    failureThreshold: 3

# Autoscaling - enabled for development testing
autoscaling:
  backend:
    enabled: true
    minReplicas: 2
    maxReplicas: 4
    targetCPUUtilizationPercentage: 70
  frontend:
    enabled: true
    minReplicas: 2
    maxReplicas: 4
    targetCPUUtilizationPercentage: 70

# Ingress - enabled for development
ingress:
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-staging"  # Staging certs for dev
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
  hosts:
    - host: dev.todo-chatbot.example.com
      paths:
        - path: /
          pathType: Prefix
    - host: dev-api.todo-chatbot.example.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: todo-chatbot-dev-tls
      hosts:
        - dev.todo-chatbot.example.com
        - dev-api.todo-chatbot.example.com

# Additional labels
labels:
  app: todo-chatbot
  managed-by: helm
  environment: dev
  tier: development
